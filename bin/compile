#!/bin/bash

arrow() {
  echo '----->' "$@"
}

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1
#CACHE_DIR=$2
#ENV_DIR=$3

arrow "Setting up .profile.d to automatically run metrics agent..."
mkdir -p "${BUILD_DIR}/.profile.d"
cp .profile.d/heroku-nodejs-metrics-plugin.sh "${BUILD_DIR}/.profile.d"

if [[ -d "${BUILD_DIR}/package.json" ]]; then
    arrow "Installing Nodejs metrics plugin"
    mkdir -p "${BUILD_DIR}/bin/"

    # agent_jar="${BUILD_DIR}/bin/heroku-metrics-agent.jar"
    # curl --retry 3 -s -o ${agent_jar} \
    #   -L ${HEROKU_METRICS_JAR_URL:-"http://repo1.maven.org/maven2/com/heroku/agent/heroku-java-metrics-agent/3.3/heroku-java-metrics-agent-3.3.jar"}
    # if [[ ! -f ${agent_jar} ]]; then
    #     indent "WARNING: failed to install metrics agent!"
    # fi
fi